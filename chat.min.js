var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

var __extends=this.__extends||function(d,b){for(var p in b)if(b.hasOwnProperty(p))d[p]=b[p];function __(){this.constructor=d}__.prototype=b.prototype;d.prototype=new __()};var AppInfo={StartAddress:"ns.exitgames.com:9093",AppId:"526d3b7c-9257-4ae4-a7b1-94b65d2b877a",AppVersion:"c1.0"};var StartAddress=this.AppInfo&&this.AppInfo.StartAddress?this.AppInfo.StartAddress:"localhost:9090";var AppId=this.AppInfo&&this.AppInfo.AppId?this.AppInfo.AppId:"<no-app-id>";var AppVersion=this.AppInfo&&this.AppInfo.AppVersion?this.AppInfo.AppVersion:"1.0";function timeSec(){return Date.now()/1000}var formatTime=function(a){var b=new Date(a);var c=Math.floor(b/36e5),minutes=Math.floor((b%36e5)/6e4),seconds=Math.floor(b%60000/1000);return c+" hours, "+minutes+" minutes and "+seconds+" seconds"};var Chat=(function(u){__extends(Chat,u);function Chat(){u.call(this,StartAddress,AppId,AppVersion);this.logger=new Exitgames.Common.Logger("Chat: ");this.USERCOLORS=["#00CCFF","#44DA44","#FFCC00","#FAFF80","#00FFAA","#F36CF3","#F3097E","#8AFF80","#C88CFF","#9FDFDF"];this.pw="";this.mutedUsers=[];this.sessionDC=false;this.clickedUser="";this.ff={cooldownTime:3,extraTime:0,extraTimeInterval:5,maxMessages:3,currentMessages:0,lastMessage:0};this.setLogLevel(Exitgames.Common.Logger.Level.ERROR);this.logger.info("Init",StartAddress,AppId,AppVersion)}Chat.prototype.onError=function(a,b){this.logger.info("Error "+a+": "+b)};Chat.prototype.ajaxRequest=function(d){var e=JSON.stringify(d);var f=themeUrl+'/php/send_postrq.php';return $.ajax({url:f,data:e,type:'post',contentType:"application/json",error:function(a,b,c){ChatClient.logger.info("Ajax request error:",c)}})};Chat.prototype.handleResult=function(a){var b;try{b=$.parseJSON(a)}catch(e){this.output("Operation failed: server error.");return false}if(b.result==="error"){this.output("Operation failed: server error.");return false}else{return b}};Chat.prototype.leaveChat=function(){this.sessionDC=true;this.disconnect();$("#userinput").html("<div class='dctext'>You have been disconnected from the chat.</div>")};Chat.prototype.ActorListUpdate=function(){var a=document.getElementById("playerlist");var b=this.myRoomActors();var c=Object.keys(b);a.innerHTML="";var d=document.getElementById('tab_players');d.innerHTML="Players ("+c.length+")";for(var i=0;i<c.length;i++){index=c[i];if(b[index].getCustomProperty("mod")){a.innerHTML=a.innerHTML+b[index].name+"[MOD]<br>"}else{a.innerHTML=a.innerHTML+b[index].name+"<br>"}}};Chat.prototype.floodFilter=function(){if(timeSec()>this.ff.lastMessage+this.ff.cooldownTime+this.ff.extraTime){this.ff.currentMessages=0;this.ff.extraTime=0}if(this.ff.currentMessages>=this.ff.maxMessages){this.ff.extraTime=(this.ff.currentMessages-this.ff.maxMessages+1)*this.ff.extraTimeInterval;var a=(this.ff.lastMessage+this.ff.extraTime+this.ff.cooldownTime-timeSec()).toFixed(2);this.ff.currentMessages++;return a}else{this.ff.lastMessage=timeSec();this.ff.currentMessages++;return false}};Chat.prototype.login=function(a){switch(a.ResultCode){case 1:var b=a.Mod;this.myActor().setCustomProperty("mod",b);this.myActor().name=a.Name;this.connectToNameServer();break;case 2:this.output("Couldn't reach login server. Please try again later.");break;case 3:this.output("Invalid username or password.");break;case 4:var c=a.Data;var d=formatTime(c*1000);this.output("You are banned from the chat. Your ban will be lifted in "+d+".");break;default:this.output("Login error.")}};Chat.prototype.onEvent=function(a,b,c){switch(a){case 1:var d=this.myRoomActors()[c].name;if($.inArray(d,this.mutedUsers)===-1){this.output(b,this.myRoomActors()[c].getCustomProperty("color"),d)}break;case 10:var e=b.player;var f=b.reason;var g=b.duration;if(this.myActor().name===e){this.output('You were banned from the chat.');this.output('Duration: '+g+' minutes');this.output('Reason: '+f);this.leaveChat()}else{this.output(e+" has been banned for "+g+" minutes.")}break;default:}this.logger.debug("onEvent",a,"content:",b,"actor:",c)};Chat.prototype.onStateChange=function(a){var b=Photon.LoadBalancing.LoadBalancingClient;if(b.StateToName(a)==='JoinedLobby'){this.createRoom('cspWebChat');this.joinRoom('cspWebChat')}else if(b.StateToName(a)==='Joined'){$("#name").fadeOut("slow");$("#message").delay(600).fadeIn("slow")}else if(b.StateToName(a)==='ConnectedToNameServer'){this.connectToRegionMaster('EU')}};Chat.prototype.onJoinRoom=function(){this.output("Joined chat as "+this.myActor().name+".");this.ActorListUpdate();var a=Math.floor(Math.random()*this.USERCOLORS.length);var b=this.USERCOLORS[a];this.myActor().setCustomProperty("color",this.USERCOLORS[a]);if(this.myActor().getCustomProperty("mod")){this.setupModUI();$('#banbutton').show()}};Chat.prototype.onActorJoin=function(a){this.output(a.name+" joined.");this.ActorListUpdate();if(a.name===this.myActor().name){this.output("Disconnected from chat (duplicate login).");this.leaveChat()}};Chat.prototype.onActorLeave=function(a){if(this.sessionDC===false){this.output(a.name+" left.");this.ActorListUpdate()}};Chat.prototype.sendMessage=function(a){try{this.raiseEvent(1,a,this.myActor().actorNr);this.output(a,this.myActor().getCustomProperty("color"),this.myActor().name)}catch(err){this.output("error: "+err.message)}};Chat.prototype.setupUI=function(){var j=this;var k=document.getElementById("joinform");k.onsubmit=function(){if(j.sessionDC===true){j.output("Reload page to reconnect.")}else{var c=document.getElementById("userid");var d=document.getElementById("userpw");var e=c.value;j.pw=btoa(d.value);if(e!==""&&j.pw!==""){j.output("Logging in...");c.value='';d.value='';var f={user:e,pw:j.pw,reqType:'login'};j.ajaxRequest(f).done(function(a){var b=j.handleResult(a);if(b!==false){j.login(b)}})}else{j.output("Please fill in both fields.")}}return false};var l=document.getElementById("chatform");l.onsubmit=function(){if(j.isJoinedToRoom()){var a=document.getElementById("msginput");var b=a.value;if(b===""){j.output("Message can't be empty.")}else if(b.length>100){j.output("Your message is too long (Max length: 100).")}else{var c=j.floodFilter();if(c===false){j.sendMessage(b);a.value='';a.focus()}else{j.output("You are sending messages too fast. Please wait "+c+" seconds.")}}}else{j.output("Disconnected, reload page to reconnect.")}return false};var m=document.getElementById('chat-toggle');var n=document.getElementById('chatArrow');m.onclick=function(){preventSelect(m);var a=document.getElementById('photon-chatbox');if(a.style.display=='none'){a.style.display='block';m.style.bottom='474px';n.className='icon-caret-down'}else{a.style.display='none';m.style.bottom='0';n.className='icon-caret-up'}};$tab_players=$('#tab_players');$tab_chat=$('#tab_chat');$tab_players.click(function(){$('#log').hide();$('#playerlist').show();$tab_players.addClass("activeTab");$tab_chat.removeClass("activeTab")});$tab_chat.click(function(){$('#log').show();$('#playerlist').hide();$tab_players.removeClass("activeTab");$tab_chat.addClass("activeTab")});var o=document.getElementById('mutebutton');var p=document.getElementById('unmutebutton');var q=$('#usermenu');Chat.prototype.showUserMenu=function(a,b){if(this.sessionDC===false){j.clickedUser=b.id;if($.inArray(j.clickedUser,j.mutedUsers)===-1){$('#mutebutton').show();$('#unmutebutton').hide()}else{$('#unmutebutton').show();$('#mutebutton').hide()}$('#usermenu_banform').hide();$("#usermenu_reportform").hide();$('#usermenu_buttons').show();q.show();username.innerHTML=j.clickedUser}};var r=document.getElementById('closebutton');r.onclick=function(){q.hide()};o.onclick=function(){if(j.clickedUser===j.myActor().name){j.output("You cannot mute yourself.")}else{j.mutedUsers.push(j.clickedUser);j.output(j.clickedUser+" has been muted.")}q.hide()};p.onclick=function(){var a=j.mutedUsers.indexOf(j.clickedUser);j.mutedUsers.splice(a,1);j.output(j.clickedUser+" is no longer muted.");q.hide()};var s=document.getElementById('reportbutton');s.onclick=function(){if(j.clickedUser===j.myActor().name){j.output("You cannot report yourself.");q.hide()}else{$("#usermenu_buttons").fadeOut();$("#usermenu_reportform").delay(400).fadeIn()}};var t=document.getElementById('reportform');t.onsubmit=function(){var c=document.getElementById('reportreason');var d=c.options[c.selectedIndex];var e=$('.newline').last();var f=e.text();var g=e;for(var i=0;i<9;i++){g=g.prev();f=g.text()+"\n"+f}var h={user:j.clickedUser,reporter:j.myActor().name,reason:d.value,chatlog:f,reqType:'report'};j.output("Sending report...");j.ajaxRequest(h).done(function(a){var b=j.handleResult(a);if(b!==false){if(b.result==="24hlimit"){j.output("You can't report the same user more than once per 24 hours.")}else if(b.result==="success"){j.output(j.clickedUser+" has been reported for "+d.text+".")}else{j.output("Report failed: server error.")}}});q.hide();return false}};Chat.prototype.setupModUI=function(){var f=this;var g=document.getElementById('banbutton');g.onclick=function(){$("#usermenu_buttons").fadeOut();$("#usermenu_banform").delay(400).fadeIn()};var h=document.getElementById('banform');h.onsubmit=function(){var c=document.getElementById('banreason');var d=document.getElementById('bantime');var e={user:f.clickedUser,duration:d.value*60,reason:c.value,modName:f.myActor().name,modPw:f.pw,reqType:'ban'};f.output("Sending ban to server...");f.ajaxRequest(e).done(function(a){var b=f.handleResult(a);if(b!==false){if(b.result==="notmod"){f.output("Error: You are not a moderator.")}else if(b.result==="success"){f.output(e.user+" has been banned for "+d.value+" minutes.");f.raiseEvent(10,{player:e.user,reason:e.reason,duration:d.value},f.myActor().actorNr);h.reset();$('#usermenu').hide()}}});return false}};Chat.prototype.output=function(a,b,c){var d=document.getElementById("log");var e=a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;");if(b){e="<span class='chatfeedname' onclick='ChatClient.showUserMenu(event, this);' id='"+c+"' style='color: "+b+";'>"+c+":</span> "+e}else{e="<span class='systemtext'>"+e+"</span>"}d.innerHTML=d.innerHTML+"<div class='newline'>"+e+"</div>";$('.newline').last().profanityFilter();d.scrollTop=d.scrollHeight};return Chat})(Photon.LoadBalancing.LoadBalancingClient);var ChatClient;window.onload=function(){ChatClient=new Chat();ChatClient.setupUI()};

}
/*
     FILE ARCHIVED ON 00:03:43 Dec 19, 2016 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 15:20:45 Mar 16, 2021.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  exclusion.robots: 0.373
  captures_list: 8358.534
  LoadShardBlock: 8327.651 (3)
  RedisCDXSource: 0.783
  PetaboxLoader3.datanode: 7701.786 (5)
  esindex: 0.016
  PetaboxLoader3.resolve: 163.289 (3)
  exclusion.robots.policy: 0.356
  CDXLines.iter: 25.115 (3)
  load_resource: 183.751 (2)
*/